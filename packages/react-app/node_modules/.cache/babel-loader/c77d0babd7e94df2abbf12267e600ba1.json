{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\"; // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\nexport function withTimeout(sync, timeout, timeoutError) {\n  var _this = this;\n\n  if (timeoutError === void 0) {\n    timeoutError = new Error('timeout');\n  }\n\n  return {\n    acquire: function () {\n      return new Promise(function (resolve, reject) {\n        return __awaiter(_this, void 0, void 0, function () {\n          var isTimeout, ticket, release;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                isTimeout = false;\n                setTimeout(function () {\n                  isTimeout = true;\n                  reject(timeoutError);\n                }, timeout);\n                return [4\n                /*yield*/\n                , sync.acquire()];\n\n              case 1:\n                ticket = _a.sent();\n\n                if (isTimeout) {\n                  release = Array.isArray(ticket) ? ticket[1] : ticket;\n                  release();\n                } else {\n                  resolve(ticket);\n                }\n\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      });\n    },\n    runExclusive: function (callback) {\n      return __awaiter(this, void 0, void 0, function () {\n        var release, ticket;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              release = function () {\n                return undefined;\n              };\n\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1,, 7, 8]);\n\n              return [4\n              /*yield*/\n              , this.acquire()];\n\n            case 2:\n              ticket = _a.sent();\n              if (!Array.isArray(ticket)) return [3\n              /*break*/\n              , 4];\n              release = ticket[1];\n              return [4\n              /*yield*/\n              , callback(ticket[0])];\n\n            case 3:\n              return [2\n              /*return*/\n              , _a.sent()];\n\n            case 4:\n              release = ticket;\n              return [4\n              /*yield*/\n              , callback()];\n\n            case 5:\n              return [2\n              /*return*/\n              , _a.sent()];\n\n            case 6:\n              return [3\n              /*break*/\n              , 8];\n\n            case 7:\n              release();\n              return [7\n              /*endfinally*/\n              ];\n\n            case 8:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    },\n    release: function () {\n      sync.release();\n    },\n    isLocked: function () {\n      return sync.isLocked();\n    }\n  };\n}","map":{"version":3,"sources":["/Users/Antonio/Desktop/SuperRent/node_modules/async-mutex/es6/withTimeout.js"],"names":["__awaiter","__generator","withTimeout","sync","timeout","timeoutError","_this","Error","acquire","Promise","resolve","reject","isTimeout","ticket","release","_a","label","setTimeout","sent","Array","isArray","runExclusive","callback","undefined","trys","push","isLocked"],"mappings":"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","sourcesContent":["import { __awaiter, __generator } from \"tslib\";\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function withTimeout(sync, timeout, timeoutError) {\n    var _this = this;\n    if (timeoutError === void 0) { timeoutError = new Error('timeout'); }\n    return {\n        acquire: function () {\n            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\n                var isTimeout, ticket, release;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            isTimeout = false;\n                            setTimeout(function () {\n                                isTimeout = true;\n                                reject(timeoutError);\n                            }, timeout);\n                            return [4 /*yield*/, sync.acquire()];\n                        case 1:\n                            ticket = _a.sent();\n                            if (isTimeout) {\n                                release = Array.isArray(ticket) ? ticket[1] : ticket;\n                                release();\n                            }\n                            else {\n                                resolve(ticket);\n                            }\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n        },\n        runExclusive: function (callback) {\n            return __awaiter(this, void 0, void 0, function () {\n                var release, ticket;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            release = function () { return undefined; };\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, , 7, 8]);\n                            return [4 /*yield*/, this.acquire()];\n                        case 2:\n                            ticket = _a.sent();\n                            if (!Array.isArray(ticket)) return [3 /*break*/, 4];\n                            release = ticket[1];\n                            return [4 /*yield*/, callback(ticket[0])];\n                        case 3: return [2 /*return*/, _a.sent()];\n                        case 4:\n                            release = ticket;\n                            return [4 /*yield*/, callback()];\n                        case 5: return [2 /*return*/, _a.sent()];\n                        case 6: return [3 /*break*/, 8];\n                        case 7:\n                            release();\n                            return [7 /*endfinally*/];\n                        case 8: return [2 /*return*/];\n                    }\n                });\n            });\n        },\n        release: function () {\n            sync.release();\n        },\n        isLocked: function () { return sync.isLocked(); },\n    };\n}\n"]},"metadata":{},"sourceType":"module"}